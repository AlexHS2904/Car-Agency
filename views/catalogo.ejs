<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Catálogo de autos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!--  CSS -->
    <link rel="stylesheet" href="/Assets/styles.css" />
    <!-- BOOTSTRAP -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body.catalog-page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: #f8f9fa;
      }

      h2{
            font-family: "Montserrat", sans-serif !important;
            font-optical-sizing: auto;
            font-weight: 400 !important;
            font-style: normal;
      }

      .catalog-wrapper {
        flex: 1 0 auto;
        padding-top: 90px;
        padding-bottom: 40px;
      }

      .car-card {
        border: none;
        border-radius: 16px;
        overflow: hidden;
        background: #fff;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease;
      }

      .car-card:hover {
        transform: translateY(-3px);
      }

      /* solo la imagen principal */
      .car-card > img {
        width: 100%;
        height: 180px;
        object-fit: cover;
      }

      /* iconito de persona */
      .car-card img.icon {
        width: 16px;
        height: 16px;
        object-fit: contain;
      }

      footer {
        margin-top: auto;
      }

      @media (max-width: 576px) {
  .row.g-4 > [class*="col-"] {
    flex: 0 0 50%;
    max-width: 50%;
  }

  .car-card {
    border-radius: 12px;
  }

  .car-card > img {
    height: 120px;
  }

  .car-card .p-3 {
    padding: 0.6rem 0.6rem 0.8rem;
  }

  .car-card h5 {
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
  }

  .car-card p {
    font-size: 0.7rem;
  }

  .car-card .badge {
    font-size: 0.6rem;
    padding: 0.25rem 0.4rem;
  }

  .car-card .d-flex {
    gap: 0.25rem;
  }

  .car-card .fw-semibold {
    font-size: 0.85rem !important;
    margin-bottom: 0.6rem;
  }

  .car-card .btn {
    font-size: 0.7rem;
    padding: 0.35rem 0.5rem;
  }

  .catalog-wrapper {
    padding-top: 75px;
    padding-left: 8px;
    padding-right: 8px;
  }

  h2.mb-4 {
    font-size: 1.1rem;
    margin-bottom: 1rem !important;
  }
}



    /* Barra filro*/

    .price-range {
    appearance: none;
    width: 100%;
    height: 6px;
    background: #ddd;
    border-radius: 999px;
    outline: none;
}

.price-range::-webkit-slider-runnable-track {
  height: 6px;
  background: #ddd;
  border-radius: 999px;
}

.price-range::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #dc3545;
  border-radius: 50%;
  border: 2px solid #fff;
  box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.25);
  cursor: pointer;
  margin-top: -6px;
}

    </style>
  </head>
  <body class="catalog-page">
    <!-- header -->
    <%- include("partials/header.ejs") %>

    <main class="catalog-wrapper">
      <div class="container">
        <h2 class="mb-4">Catálogo de autos</h2>

        <!-- Filtros -->
        <form method="GET" action="/catalogo" class="row g-3 mb-4">
          <div class="col-md-3">
  <label for="year" class="form-label">Año</label>
  <select id="year" name="year" class="form-select">
    <option value="">Todos</option>
    <% for (let y = 2026; y >= 1980; y--) { %>
      <option value="<%= y %>" <%= filters.year === String(y) ? 'selected' : '' %>><%= y %></option>
    <% } %>
  </select>
</div>


          <div class="col-md-3">
            <label for="tipo" class="form-label">Tipo</label>
            <select id="tipo" name="tipo" class="form-select">
              <option value="">Todos</option>
              <option value="sedan" <%= filters.tipo === 'sedan' ? 'selected' : '' %>>Sedán</option>
              <option value="hatchback" <%= filters.tipo === 'hatchback' ? 'selected' : '' %>>Hatchback</option>
              <option value="suv" <%= filters.tipo === 'suv' ? 'selected' : '' %>>SUV / Camioneta</option>
            </select>
          </div>

         <div class="col-md-3">
            <label for="max_price" class="form-label">
                Precio máximo (por día):
                <span id="priceValue"><%= filters.max_price || 1500 %></span>
            </label>

            <input
                type="range"
                class="price-range"
                id="max_price"
                name="max_price"
                min="0"
                max="10000"
                step="100"
                value="<%= filters.max_price || 1500 %>"
            />
        </div>


          <div class="col-md-3 d-flex align-items-end gap-2">
            <button type="submit" class="btn btn-outline-dark w-100">
              Filtrar
            </button>
            <a href="/catalogo" class="btn btn-secondary">Limpiar</a>
          </div>
        </form>

        <!-- Cards -->
        <div class="row g-4">
          <% if (cars.length === 0) { %>
            <div class="col-12">
              <div class="alert alert-info">
                No hay autos que coincidan con los filtros.
              </div>
            </div>
          <% } %>

          <% cars.forEach(car => { %>
  <div class="col-sm-6 col-md-4 col-lg-3">
    <div class="car-card">
      <img
        src="<%= car.image_url && car.image_url !== '' ? car.image_url : '/Assets/Imgs/placeholder-car.jpg' %>"
        alt="<%= car.brand %> <%= car.model %>"
      >
      <div class="p-3">
        <!-- nombre -->
        <h5 class="mb-1"><%= car.brand %> <%= car.model %></h5>

        <!-- tipo (body_type) -->
        <% 
          const type = car.body_type ? car.body_type.toLowerCase() : null;
          let typeLabel = "";
          if (type === "sedan") typeLabel = "Sedán";
          else if (type === "hatchback") typeLabel = "Hatchback";
          else if (type === "suv") typeLabel = "SUV / Camioneta";
          else if (type === "pickup") typeLabel = "Pickup";
          else if (type) typeLabel = type.charAt(0).toUpperCase() + type.slice(1);
        %>
        <% if (typeLabel) { %>
          <p class="mb-2">
            <span class="badge bg-light text-dark">
              <%= typeLabel %>
            </span>
          </p>
        <% } %>

        <!-- detalles: pasajeros y año -->
        <div class="d-flex justify-content-between align-items-center mb-2 small text-muted">
          <span class="d-flex align-items-center gap-1">
            <img class="icon" src="/Assets/Imgs/person.svg" alt="person">
            <%= car.seats || 5 %> pax
          </span>
          <span><%= car.year %></span>
        </div>

        <!-- precio -->
        <p class="fw-semibold mb-3" style="font-size: 1.05rem;">
          $<%= Number(car.price_per_day).toLocaleString('es-MX') %> MXN/día
        </p>

        <% if (currentUser) { %>
          <a href="/cars/<%= car.id %>/reserve" class="btn btn-sm btn-outline-dark w-100">
            Rentar
          </a>
        <% } else { %>
          <a href="/login?returnTo=/cars/<%= car.id %>/reserve" class="btn btn-sm btn-outline-dark w-100">
            Rentar
          </a>
        <% } %>
      </div>
    </div>
  </div>
<% }) %>
        </div>
      </div>
    </main>

    <!-- footer -->
    <%- include("partials/footer.ejs") %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const priceInput = document.getElementById('max_price');
        const priceValue = document.getElementById('priceValue');

        if (priceInput && priceValue) {
            priceInput.addEventListener('input', () => {
            priceValue.textContent = priceInput.value;
            });
        }
    </script>
  </body>
</html>
