<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Editar auto #<%= car.id %> â€” <%= car.brand %> <%= car.model %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/Assets/styles.css">
  <style>
    /* ====== LAYOUT BASE (sidebar igual que admin) ====== */
    .admin-layout { display:flex; min-height:100vh; background:#f1f5f9; }

    #adminSidebar {
      background:#0f172a; color:#fff; padding:1rem 1.25rem;
      display:flex; flex-direction:column; gap:1rem; min-width:230px;
    }
    #adminSidebar .admin-sidebar__brand { display:flex; gap:.5rem; align-items:center; font-weight:600; }
    #adminSidebarNav { display:flex; flex-direction:column; gap:.4rem; }
    #adminSidebarNav .admin-sidebar__link {
      color:#e2e8f0; text-decoration:none; padding:.4rem .6rem; border-radius:.35rem;
    }
    #adminSidebarNav .admin-sidebar__link--active { background:rgba(255,255,255,.1); }
    #adminSidebarToggle { display:none; }

    .main { flex:1; padding:1.5rem; }
    .shell {
      max-width:980px; margin:0 auto; background:#fff; border-radius:1rem;
      padding:1rem 1.2rem; box-shadow:0 10px 25px rgba(15,23,42,.05);
    }

    /* ====== FORM ====== */
    h1 { margin:.2rem 0; font-weight:600; }
    .subtitle { color:#64748b; margin:0 0 1rem; font-weight:400; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }

    label { font-weight:400; margin:.25rem 0; display:block; }
    input, select, textarea {
      width:100%; padding:.55rem .7rem; border:1px solid #e5e7eb; border-radius:.5rem; background:#fff;
    }
    textarea { min-height:110px; }

    .preview {
      margin-top:.5rem; width:100%; height:220px; background:#f3f4f6;
      border:1px dashed #d1d5db; border-radius:.8rem; display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    .preview img { width:100%; height:100%; object-fit:cover; }
    .alert { background:#fee2e2; border:1px solid #fecaca; color:#7f1d1d; padding:.6rem .8rem; border-radius:.6rem; margin-bottom:.8rem; }
    .btn { display:inline-block; border:1px solid #111827; padding:.5rem .9rem; border-radius:.6rem; background:#fff; color:#111827; text-decoration:none; }
    .btn-primary { border-color:#111827; background:#111827; color:#fff; }
    .btn-light { background:#fff; color:#111827; }

    @media (max-width:900px){
      .admin-layout { flex-direction:column; }
      #adminSidebar {
        width:100%; flex-direction:row; align-items:center; justify-content:space-between; position:relative;
      }
      #adminSidebarToggle {
        display:inline-block; background:none; border:1px solid rgba(255,255,255,.3);
        color:#fff; border-radius:.4rem; padding:.25rem .5rem; font-size:.9rem;
      }
      #adminSidebarNav {
        display:none; flex-direction:column; gap:.5rem; background:#0f172a; width:100%;
        position:absolute; top:100%; left:0; padding:.6rem .75rem .75rem;
        border-bottom-left-radius:.75rem; border-bottom-right-radius:.75rem;
        box-shadow:0 10px 25px rgba(15,23,42,.25); z-index:999;
      }
      #adminSidebar.is-open #adminSidebarNav { display:flex !important; }
    }
  </style>
</head>
<body class="admin-layout">
  <!-- Sidebar -->
  <aside id="adminSidebar">
    <div class="admin-sidebar__brand">
      <span class="admin-sidebar__icon">ðŸš—</span>
      <span class="admin-sidebar__title">Auto Dealer</span>
    </div>
    <button id="adminSidebarToggle" type="button">â˜°</button>
    <nav id="adminSidebarNav">
      <a href="/admin/dashboard" class="admin-sidebar__link">Dashboard</a>
      <a href="/autos" class="admin-sidebar__link admin-sidebar__link--active">Inventario</a>
      <a href="/admin/ventas" class="admin-sidebar__link">Ventas / Reservas</a>
      <a href="/admin/autos/nuevo" class="admin-sidebar__link">Publicar auto</a>
      <a href="/" class="admin-sidebar__link" target="_blank">Ver sitio</a>
    </nav>
  </aside>

  <!-- Contenido -->
  <main class="main">
    <div class="shell">
      <h1>Editar auto #<%= car.id %> â€” <%= car.brand %> <%= car.model %></h1>
      <p class="subtitle">Actualiza los datos y guarda los cambios.</p>

      <% if (error) { %>
        <div class="alert"><%= error %></div>
      <% } %>

      <form action="/admin/autos/<%= car.id %>/editar" method="POST" enctype="multipart/form-data">
        <div class="grid">
          <!-- Columna izquierda -->
          <div>
            <label>Marca</label>
            <input type="text" name="brand" value="<%= car.brand %>" required>

            <label style="margin-top:.6rem;">Modelo</label>
            <input type="text" name="model" value="<%= car.model %>" required>

            <label style="margin-top:.6rem;">AÃ±o</label>
            <select name="year" required>
              <% for (let y = 2026; y >= 1980; y--) { %>
                <option value="<%= y %>" <%= Number(car.year) === y ? "selected" : "" %>><%= y %></option>
              <% } %>
            </select>

            <label style="margin-top:.6rem;">Precio por dÃ­a (MXN)</label>
            <input type="number" name="price_per_day" step="100" min="0" value="<%= car.price_per_day %>" required>

            <label style="margin-top:.6rem;">Asientos</label>
            <input type="number" name="seats" min="1" max="9" value="<%= car.seats || '' %>">

            <label style="margin-top:.6rem;">Estatus</label>
            <select name="status">
              <% const st = (car.status || 'available').toLowerCase(); %>
              <option value="available" <%= st==='available' || st==='publicado' ? 'selected' : '' %>>available</option>
              <option value="reserved"  <%= st==='reserved' ? 'selected' : '' %>>reserved</option>
              <option value="sold"      <%= st==='sold' ? 'selected' : '' %>>sold</option>
            </select>

            <label style="margin-top:.6rem;">DescripciÃ³n</label>
            <textarea name="description"><%= car.description || '' %></textarea>
          </div>

          <!-- Columna derecha -->
          <div>
            <label>Tipo de carrocerÃ­a</label>
            <select name="body_type">
              <option value="">-- Selecciona --</option>
              <option value="sedan"      <%= car.body_type==='sedan' ? 'selected' : '' %>>SedÃ¡n</option>
              <option value="hatchback"  <%= car.body_type==='hatchback' ? 'selected' : '' %>>Hatchback</option>
              <option value="suv"        <%= car.body_type==='suv' ? 'selected' : '' %>>SUV / Camioneta</option>
              <option value="pickup"     <%= car.body_type==='pickup' ? 'selected' : '' %>>Pickup</option>
              <option value="luxury"     <%= car.body_type==='luxury' ? 'selected' : '' %>>Lujo</option>
            </select>

            <label style="margin-top:.6rem;">URL de la imagen (se prioriza si no subes archivo)</label>
            <input
              type="text"
              id="image_url"
              name="image_url"
              value="<%= car.image_url || '' %>"
              placeholder="https://... o /uploads/archivo.jpg"
              oninput="previewFromUrl(this.value)"
            >

            <label style="margin-top:.6rem;">Subir nueva imagen (opcional)</label>
            <input type="file" name="image" accept="image/*" onchange="previewFromFile(this)">

            <div class="preview" id="previewBox">
              <% const src = (car.image_url && car.image_url !== '') ? car.image_url : '/Assets/Imgs/placeholder-car.jpg'; %>
              <img src="<%= src %>" alt="preview">
            </div>
          </div>
        </div>

        <div style="display:flex; gap:.5rem; margin-top:1rem;">
          <button type="submit" class="btn btn-primary">Guardar</button>
          <a href="/autos" class="btn btn-light">Cancelar</a>
        </div>
      </form>
    </div>
  </main>

  <script>
    // Toggle hamburguesa
    const adminBtn = document.getElementById('adminSidebarToggle');
    const adminSidebar = document.getElementById('adminSidebar');
    if (adminBtn && adminSidebar) {
      adminBtn.addEventListener('click', () => adminSidebar.classList.toggle('is-open'));
    }

    // Preview helpers
    function setPreview(src) {
      const box = document.getElementById("previewBox");
      box.innerHTML = "";
      const img = document.createElement("img");
      img.src = src;
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      box.appendChild(img);
    }
    function previewFromUrl(val) {
      if (!val) return;
      setPreview(val);
    }
    function previewFromFile(input) {
      if (!input.files || !input.files[0]) return;
      const reader = new FileReader();
      reader.onload = (e) => setPreview(e.target.result);
      reader.readAsDataURL(input.files[0]);
    }
  </script>
</body>
</html>
