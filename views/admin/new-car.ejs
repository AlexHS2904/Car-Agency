<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Publicar auto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/Assets/styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .form-shell {
        background: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 10px 35px rgba(15,15,15,.05);
      }
      .preview-box {
        background: #f1f1f1;
        border: 1px dashed #ccc;
        border-radius: 1rem;
        min-height: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .preview-box img { width: 100%; height: 100%; object-fit: cover; }

      .main-inner {
        max-width: 950px;
        margin: 0 auto;
      }

      /* layout base */
      .admin-layout {
        display: flex;
        min-height: 100vh;
        background: #f1f5f9;
      }

      /* SIDEBAR PROTEGIDA POR ID */
      #adminSidebar {
        background: #0f172a;
        color: #fff;
        padding: 1rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-width: 230px;
      }
      #adminSidebar .sidebar__brand {
        display: flex;
        align-items: center;
        gap: .5rem;
        font-weight: 600;
      }
      #adminSidebarNav {
        display: flex;
        flex-direction: column;
        gap: .4rem;
      }
      #adminSidebarNav .sidebar__link {
        color: #e2e8f0;
        text-decoration: none;
        padding: .4rem .6rem;
        border-radius: .5rem;
      }
      #adminSidebarNav .sidebar__link--active {
        background: rgba(255,255,255,.12);
      }

      .main {
        flex: 1;
        padding: 1.5rem;
      }

      /* hamburguesa */
      #adminSidebarToggle {
        display: none;
      }

      @media (max-width: 900px) {
        .admin-layout {
          flex-direction: column;
        }

        #adminSidebar {
          width: 100%;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          position: relative;
        }

        #adminSidebarToggle {
          display: inline-block;
          background: none;
          border: 1px solid rgba(255,255,255,.3);
          color: #fff;
          border-radius: .4rem;
          padding: .25rem .5rem;
          font-size: .9rem;
        }

        /* oculto por defecto en mobile */
        #adminSidebarNav {
          display: none;
          flex-direction: column;
          gap: .5rem;
          background: #0f172a;
          width: 100%;
          position: absolute;
          top: 100%;
          left: 0;
          padding: .6rem .75rem .75rem;
          border-bottom-left-radius: .75rem;
          border-bottom-right-radius: .75rem;
          box-shadow: 0 10px 25px rgba(15,23,42,.25);
          z-index: 999;
        }

        /* cuando el aside tenga la clase, ya se ve */
        #adminSidebar.is-open #adminSidebarNav {
          display: flex !important;
        }

        .main {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body class="admin-layout">
    <!-- Sidebar -->
    <aside id="adminSidebar">
      <div class="sidebar__brand">
        <span class="sidebar__icon">üöó</span>
        <span class="sidebar__title">Auto Dealer</span>
      </div>
      <button id="adminSidebarToggle" type="button">‚ò∞</button>
      <nav id="adminSidebarNav">
        <a href="/admin/dashboard" class="sidebar__link">Dashboard</a>
        <a href="/autos" class="sidebar__link">Inventario</a>
        <a href="/admin/ventas" class="sidebar__link">Ventas / Reservas</a>
        <a href="/admin/autos/nuevo" class="sidebar__link sidebar__link--active">Publicar auto</a>
        <a href="/" class="sidebar__link sidebar__link--secondary" target="_blank">Ver sitio</a>
      </nav>
    </aside>

    <!-- Contenido -->
    <main class="main">
      <div class="main-inner">
        <header class="main__header">
          <h1 class="main__title">Publicar nuevo auto</h1>
        </header>

        <div class="form-shell p-4 mb-5">
          <% if (typeof error !== "undefined" && error) { %>
            <div class="alert alert-danger">
              <%= error %>
            </div>
          <% } %>

          <form
            action="/admin/autos/nuevo"
            method="POST"
            enctype="multipart/form-data"
            onsubmit="return validarAuto();"
            class="row g-3"
          >
            <!-- Marca / modelo -->
            <div class="col-md-6">
              <label class="form-label" for="brand">Marca</label>
              <input
                type="text"
                id="brand"
                name="brand"
                class="form-control"
                placeholder="Ej. Audi"
                required
              />
            </div>
            <div class="col-md-6">
              <label class="form-label" for="model">Modelo</label>
              <input
                type="text"
                id="model"
                name="model"
                class="form-control"
                placeholder="Ej. Q5"
                required
              />
            </div>

            <!-- A√±o / precio / asientos -->
            <div class="col-md-4">
              <label class="form-label" for="year">A√±o</label>
              <select id="year" name="year" class="form-select" required>
                <% for (let y = 2026; y >= 1980; y--) { %>
                  <option value="<%= y %>"><%= y %></option>
                <% } %>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label" for="price_per_day">Precio por d√≠a (MXN)</label>
              <input
                type="number"
                id="price_per_day"
                name="price_per_day"
                class="form-control"
                min="0"
                step="100"
                required
              />
            </div>

            <div class="col-md-4">
              <label class="form-label" for="seats">Asientos</label>
              <input
                type="number"
                id="seats"
                name="seats"
                class="form-control"
                min="1"
                max="9"
                step="1"
                placeholder="Ej. 5"
              />
            </div>

            <!-- Body type -->
            <div class="col-md-6">
              <label class="form-label" for="body_type">Tipo de carrocer√≠a</label>
              <select id="body_type" name="body_type" class="form-select">
                <option value="">-- Selecciona --</option>
                <option value="sedan">Sed√°n</option>
                <option value="hatchback">Hatchback</option>
                <option value="suv">SUV / Camioneta</option>
                <option value="pickup">Pickup</option>
                <option value="luxury">Lujo</option>
              </select>
            </div>

            <!-- URL imagen -->
            <div class="col-md-6">
              <label class="form-label" for="image_url">URL de la imagen (opcional)</label>
              <input
                type="url"
                id="image_url"
                name="image_url"
                class="form-control"
                placeholder="https://..."
                oninput="previewFromUrl(this.value)"
              />
            </div>

            <!-- subir imagen -->
            <div class="col-md-6">
              <label class="form-label" for="image">Subir imagen (opcional)</label>
              <input
                type="file"
                id="image"
                name="image"
                class="form-control"
                accept="image/*"
                onchange="previewFromFile(this)"
              />
              <div class="form-text">Puedes pegar una URL o subir una imagen.</div>
            </div>

            <!-- preview -->
            <div class="col-md-6">
              <label class="form-label d-block">Preview</label>
              <div class="preview-box" id="previewBox">
                <span class="text-muted">Sin imagen</span>
              </div>
            </div>

            <!-- descripci√≥n opcional -->
            <div class="col-12">
              <label class="form-label" for="description">Descripci√≥n (opcional)</label>
              <textarea
                id="description"
                name="description"
                class="form-control"
                rows="3"
                placeholder="Detalles del auto, transmisi√≥n, kilometraje, etc."
              ></textarea>
            </div>

            <div class="col-12">
              <button type="submit" class="btn btn-outline-dark">
                Crear nueva publicaci√≥n
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script>
      function validarAuto() {
        const price = Number(document.getElementById("price_per_day").value);
        const year = Number(document.getElementById("year").value);
        const seats = document.getElementById("seats").value;
        const url = document.getElementById("image_url").value.trim();
        const file = document.getElementById("image").files[0];

        if (isNaN(price) || price <= 0) {
          alert("El precio debe ser mayor a 0");
          return false;
        }

        if (year < 1980 || year > 2026) {
          alert("El a√±o debe estar entre 1980 y 2026");
          return false;
        }

        if (seats && (Number(seats) <= 0 || isNaN(Number(seats)))) {
          alert("Los asientos deben ser un n√∫mero mayor a 0");
          return false;
        }

        if (!url && !file) {
          const seguir = confirm("No agregaste imagen. ¬øQuieres publicar sin imagen?");
          if (!seguir) return false;
        }

        return true;
      }

      function setPreview(src) {
        const box = document.getElementById("previewBox");
        box.innerHTML = "";
        const img = document.createElement("img");
        img.src = src;
        box.appendChild(img);
      }

      function previewFromUrl(val) {
        if (!val) {
          document.getElementById("previewBox").innerHTML = '<span class="text-muted">Sin imagen</span>';
          return;
        }
        setPreview(val);
      }

      function previewFromFile(input) {
        if (!input.files || !input.files[0]) return;
        const reader = new FileReader();
        reader.onload = (e) => setPreview(e.target.result);
        reader.readAsDataURL(input.files[0]);
      }

      // toggle men√∫
      const toggleBtn = document.getElementById('adminSidebarToggle');
      const sidebar = document.getElementById('adminSidebar');

      if (toggleBtn && sidebar) {
        toggleBtn.addEventListener('click', () => {
          sidebar.classList.toggle('is-open');
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
